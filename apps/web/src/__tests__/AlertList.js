import '@testing-library/jest-dom';
import React from 'react';
import AlertList from '../components/elements/AlertList';
import { axiosMock, render, screen } from '../testUtils';

export const notificationResponse = [
    {
        'id': '88362598-0027-4ac1-8950-b6b1d407dc3d',
        'type': 'App\\Notifications\\RequestActivity',
        'notifiable_type': 'App\\Models\\User',
        'notifiable_id': 1,
        'data': {
            'request_id': 78,
            'activity_type_id': 77,
            'message': 'Aut mollitia eos et dolores possimus nobis dolor.',
            'user_id': '1',
            'uuid': '2003307e-fe75-4971-ae33-a8030221d4ae',
            'updated_at': '2021-02-16T15:07:05.000000Z',
            'created_at': '2021-02-16T15:07:05.000000Z',
            'id': 65,
            'user': {
                'id': 1,
                'uuid': '1e84cdf0-df15-4eb8-a0eb-6b0fb9068335',
                'first_name': 'admin',
                'middle_name': null,
                'last_name': 'Admin',
                'email': 'admin@admin.com',
                'username': null,
                'email_verified_at': '2021-02-12T13:56:38.000000Z',
                'dob': '2001-02-12T00:00:00.000000Z',
                'primary_role': 'healthplan',
                'notification_prefs': null,
                'created_at': '2021-02-12T13:56:38.000000Z',
                'updated_at': '2021-02-12T14:23:15.000000Z',
                'deleted_at': null,
                'full_name': 'admin Admin',
            },
        },
        'read_at': null,
        'created_at': '2021-02-16T15:07:05.000000Z',
        'updated_at': '2021-02-16T15:07:05.000000Z',
        'human_read_at': null,
        'human_created_at': '5 seconds ago',
    },
    {
        'id': 'cd3d1a9f-1765-418e-9ded-834f07fd7d2a',
        'type': 'App\\Notifications\\RequestActivity',
        'notifiable_type': 'App\\Models\\User',
        'notifiable_id': 1,
        'data': {
            'request_id': 77,
            'activity_type_id': 76,
            'message': 'Quidem ullam voluptates vel similique a.',
            'user_id': '1',
            'uuid': '36c3eddd-dc72-430a-b372-213a6d060fae',
            'updated_at': '2021-02-16T15:07:03.000000Z',
            'created_at': '2021-02-16T15:07:03.000000Z',
            'id': 64,
            'user': {
                'id': 1,
                'uuid': '1e84cdf0-df15-4eb8-a0eb-6b0fb9068335',
                'first_name': 'admin',
                'middle_name': null,
                'last_name': 'Admin',
                'email': 'admin@admin.com',
                'username': null,
                'email_verified_at': '2021-02-12T13:56:38.000000Z',
                'dob': '2001-02-12T00:00:00.000000Z',
                'primary_role': 'healthplan',
                'notification_prefs': null,
                'created_at': '2021-02-12T13:56:38.000000Z',
                'updated_at': '2021-02-12T14:23:15.000000Z',
                'deleted_at': null,
                'full_name': 'admin Admin',
            },
        },
        'read_at': null,
        'created_at': '2021-02-16T15:07:03.000000Z',
        'updated_at': '2021-02-16T15:07:03.000000Z',
        'human_read_at': null,
        'human_created_at': '7 seconds ago',
    },
    {
        'id': '3f8a6c03-e48d-4418-aaa2-16d26a8ce1f9',
        'type': 'App\\Notifications\\RequestActivity',
        'notifiable_type': 'App\\Models\\User',
        'notifiable_id': 1,
        'data': {
            'request_id': 76,
            'activity_type_id': 75,
            'message': 'Possimus hic voluptas aperiam reprehenderit fuga est id.',
            'user_id': '1',
            'uuid': 'b5a10d86-8660-4b15-9b68-f9d8e7944128',
            'updated_at': '2021-02-16T15:07:02.000000Z',
            'created_at': '2021-02-16T15:07:02.000000Z',
            'id': 63,
            'user': {
                'id': 1,
                'uuid': '1e84cdf0-df15-4eb8-a0eb-6b0fb9068335',
                'first_name': 'admin',
                'middle_name': null,
                'last_name': 'Admin',
                'email': 'admin@admin.com',
                'username': null,
                'email_verified_at': '2021-02-12T13:56:38.000000Z',
                'dob': '2001-02-12T00:00:00.000000Z',
                'primary_role': 'healthplan',
                'notification_prefs': null,
                'created_at': '2021-02-12T13:56:38.000000Z',
                'updated_at': '2021-02-12T14:23:15.000000Z',
                'deleted_at': null,
                'full_name': 'admin Admin',
            },
        },
        'read_at': null,
        'created_at': '2021-02-16T15:07:02.000000Z',
        'updated_at': '2021-02-16T15:07:02.000000Z',
        'human_read_at': null,
        'human_created_at': '8 seconds ago',
    },
    {
        'id': '2334ce4c-d14c-420b-91e4-23f997ce2a3b',
        'type': 'App\\Notifications\\RequestActivity',
        'notifiable_type': 'App\\Models\\User',
        'notifiable_id': 1,
        'data': {
            'request_id': 75,
            'activity_type_id': 74,
            'message': 'Consequatur dolorum ipsa nostrum consequuntur architecto.',
            'user_id': '1',
            'uuid': '78e86089-0e53-48aa-b42b-6e5cdfdcd561',
            'updated_at': '2021-02-16T15:06:58.000000Z',
            'created_at': '2021-02-16T15:06:58.000000Z',
            'id': 62,
            'user': {
                'id': 1,
                'uuid': '1e84cdf0-df15-4eb8-a0eb-6b0fb9068335',
                'first_name': 'admin',
                'middle_name': null,
                'last_name': 'Admin',
                'email': 'admin@admin.com',
                'username': null,
                'email_verified_at': '2021-02-12T13:56:38.000000Z',
                'dob': '2001-02-12T00:00:00.000000Z',
                'primary_role': 'healthplan',
                'notification_prefs': null,
                'created_at': '2021-02-12T13:56:38.000000Z',
                'updated_at': '2021-02-12T14:23:15.000000Z',
                'deleted_at': null,
                'full_name': 'admin Admin',
            },
        },
        'read_at': null,
        'created_at': '2021-02-16T15:06:58.000000Z',
        'updated_at': '2021-02-16T15:06:58.000000Z',
        'human_read_at': null,
        'human_created_at': '12 seconds ago',
    },
    {
        'id': '3f909940-866c-43e3-a10f-024ebfda3542',
        'type': 'App\\Notifications\\RequestActivity',
        'notifiable_type': 'App\\Models\\User',
        'notifiable_id': 1,
        'data': {
            'request_id': 74,
            'activity_type_id': 73,
            'message': 'Officiis dolorem aut ipsum quasi veritatis explicabo.',
            'user_id': '1',
            'uuid': '99785cf6-aea4-430d-87db-e10de8cfd35e',
            'updated_at': '2021-02-16T14:45:01.000000Z',
            'created_at': '2021-02-16T14:45:01.000000Z',
            'id': 61,
            'user': {
                'id': 1,
                'uuid': '1e84cdf0-df15-4eb8-a0eb-6b0fb9068335',
                'first_name': 'admin',
                'middle_name': null,
                'last_name': 'Admin',
                'email': 'admin@admin.com',
                'username': null,
                'email_verified_at': '2021-02-12T13:56:38.000000Z',
                'dob': '2001-02-12T00:00:00.000000Z',
                'primary_role': 'healthplan',
                'notification_prefs': null,
                'created_at': '2021-02-12T13:56:38.000000Z',
                'updated_at': '2021-02-12T14:23:15.000000Z',
                'deleted_at': null,
                'full_name': 'admin Admin',
            },
        },
        'read_at': '2021-02-16T14:48:36.000000Z',
        'created_at': '2021-02-16T14:45:01.000000Z',
        'updated_at': '2021-02-16T14:48:36.000000Z',
        'human_read_at': '18 minutes ago',
        'human_created_at': '22 minutes ago',
    },
    {
        'id': '2e5bb3d2-fb51-4710-8b5d-730124034340',
        'type': 'App\\Notifications\\RequestActivity',
        'notifiable_type': 'App\\Models\\User',
        'notifiable_id': 1,
        'data': {
            'request_id': 73,
            'activity_type_id': 72,
            'message': 'Eius quis consequatur ullam et autem expedita.',
            'user_id': '1',
            'uuid': 'c547281b-6d5a-405a-b10b-456e7b5d38c6',
            'updated_at': '2021-02-16T14:44:30.000000Z',
            'created_at': '2021-02-16T14:44:30.000000Z',
            'id': 60,
            'user': {
                'id': 1,
                'uuid': '1e84cdf0-df15-4eb8-a0eb-6b0fb9068335',
                'first_name': 'admin',
                'middle_name': null,
                'last_name': 'Admin',
                'email': 'admin@admin.com',
                'username': null,
                'email_verified_at': '2021-02-12T13:56:38.000000Z',
                'dob': '2001-02-12T00:00:00.000000Z',
                'primary_role': 'healthplan',
                'notification_prefs': null,
                'created_at': '2021-02-12T13:56:38.000000Z',
                'updated_at': '2021-02-12T14:23:15.000000Z',
                'deleted_at': null,
                'full_name': 'admin Admin',
            },
        },
        'read_at': '2021-02-16T14:44:37.000000Z',
        'created_at': '2021-02-16T14:44:30.000000Z',
        'updated_at': '2021-02-16T14:44:37.000000Z',
        'human_read_at': '22 minutes ago',
        'human_created_at': '22 minutes ago',
    },
    {
        'id': '196ab37f-a55e-421b-a72d-1087563dfa4d',
        'type': 'App\\Notifications\\RequestActivity',
        'notifiable_type': 'App\\Models\\User',
        'notifiable_id': 1,
        'data': {
            'request_id': 72,
            'activity_type_id': 71,
            'message': 'Magni iste neque accusantium magnam dicta voluptatum voluptatibus.',
            'user_id': '1',
            'uuid': '3041cf09-0214-4722-89e5-b80249dc6257',
            'updated_at': '2021-02-16T14:43:28.000000Z',
            'created_at': '2021-02-16T14:43:28.000000Z',
            'id': 59,
            'user': {
                'id': 1,
                'uuid': '1e84cdf0-df15-4eb8-a0eb-6b0fb9068335',
                'first_name': 'admin',
                'middle_name': null,
                'last_name': 'Admin',
                'email': 'admin@admin.com',
                'username': null,
                'email_verified_at': '2021-02-12T13:56:38.000000Z',
                'dob': '2001-02-12T00:00:00.000000Z',
                'primary_role': 'healthplan',
                'notification_prefs': null,
                'created_at': '2021-02-12T13:56:38.000000Z',
                'updated_at': '2021-02-12T14:23:15.000000Z',
                'deleted_at': null,
                'full_name': 'admin Admin',
            },
        },
        'read_at': '2021-02-16T14:44:14.000000Z',
        'created_at': '2021-02-16T14:43:28.000000Z',
        'updated_at': '2021-02-16T14:44:14.000000Z',
        'human_read_at': '22 minutes ago',
        'human_created_at': '23 minutes ago',
    },
    {
        'id': '851a3ff8-b1db-433e-923f-b153d6014d6b',
        'type': 'App\\Notifications\\RequestActivity',
        'notifiable_type': 'App\\Models\\User',
        'notifiable_id': 1,
        'data': {
            'request_id': 71,
            'activity_type_id': 70,
            'message': 'Incidunt temporibus tenetur nobis dolorem magnam.',
            'user_id': '1',
            'uuid': '51cebe25-373a-4061-8889-67c5b192ff9b',
            'updated_at': '2021-02-16T14:43:26.000000Z',
            'created_at': '2021-02-16T14:43:26.000000Z',
            'id': 58,
            'user': {
                'id': 1,
                'uuid': '1e84cdf0-df15-4eb8-a0eb-6b0fb9068335',
                'first_name': 'admin',
                'middle_name': null,
                'last_name': 'Admin',
                'email': 'admin@admin.com',
                'username': null,
                'email_verified_at': '2021-02-12T13:56:38.000000Z',
                'dob': '2001-02-12T00:00:00.000000Z',
                'primary_role': 'healthplan',
                'notification_prefs': null,
                'created_at': '2021-02-12T13:56:38.000000Z',
                'updated_at': '2021-02-12T14:23:15.000000Z',
                'deleted_at': null,
                'full_name': 'admin Admin',
            },
        },
        'read_at': '2021-02-16T14:44:01.000000Z',
        'created_at': '2021-02-16T14:43:26.000000Z',
        'updated_at': '2021-02-16T14:44:01.000000Z',
        'human_read_at': '23 minutes ago',
        'human_created_at': '23 minutes ago',
    },
    {
        'id': '8281feb5-c00a-49fd-8db2-b0243e3ecca3',
        'type': 'App\\Notifications\\RequestActivity',
        'notifiable_type': 'App\\Models\\User',
        'notifiable_id': 1,
        'data': {
            'request_id': 70,
            'activity_type_id': 69,
            'message': 'Iure est et alias rem.',
            'user_id': 1,
            'uuid': '2eab8b4e-08ba-4e51-9100-f99be203dafd',
            'updated_at': '2021-02-16T14:01:19.000000Z',
            'created_at': '2021-02-16T14:01:19.000000Z',
            'id': 57,
            'user': {
                'id': 1,
                'uuid': '1e84cdf0-df15-4eb8-a0eb-6b0fb9068335',
                'first_name': 'admin',
                'middle_name': null,
                'last_name': 'Admin',
                'email': 'admin@admin.com',
                'username': null,
                'email_verified_at': '2021-02-12T13:56:38.000000Z',
                'dob': '2001-02-12T00:00:00.000000Z',
                'primary_role': 'healthplan',
                'notification_prefs': null,
                'created_at': '2021-02-12T13:56:38.000000Z',
                'updated_at': '2021-02-12T14:23:15.000000Z',
                'deleted_at': null,
                'full_name': 'admin Admin',
            },
        },
        'read_at': '2021-02-16T14:44:13.000000Z',
        'created_at': '2021-02-16T14:01:19.000000Z',
        'updated_at': '2021-02-16T14:44:13.000000Z',
        'human_read_at': '22 minutes ago',
        'human_created_at': '1 hour ago',
    }];

// mock the window location
const initialLocation = window.location;
delete window.location;

beforeEach(() => {
    window.location = {
        ...initialLocation,
        reload: jest.fn(),
        assign: jest.fn(),
    };
});
afterEach(() => {
    window.location = initialLocation;
    axiosMock().reset();
});

describe('Alert List', () => {
    it('Displays an alert list with read and unread alerts', async () => {
        axiosMock().onGet(/notifications/).reply('200', notificationResponse);
        // .onPut(/notifications/)
        // .reply('200', {
        //     status: true,
        // });

        // render with redux
        render(<AlertList />);

        // wait for the state changes
        const list = await screen.findByTestId('alert-list-group');
        expect(list).toMatchSnapshot();
        // expect to see the alert list component
        expect(list).toBeTruthy();
    });
});
